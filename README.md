# Simulation for missing dataset

## Create complete datasets

`create_df` can be used to create multivariable complete datasets with
independent vairables having various distributions.

    source("create_df.R", local = knitr::knit_global(), echo = FALSE)

Arguments: 1. n\_count: A scalar specifying the number of complete
datasets.

1.  n\_sample: A scalar specifying the sample size in each dataset.

2.  n\_x: A scalar specifying the number of independent variables in
    each dataset.

3.  X\_dist: A string vector of each independent variable’s
    distribution. Default is NA which means all independent variables
    are follow a multivariate normal distribution.

4.  mu: A numeric vector spesifying the mean of each independent
    variable, under X\_dist=NA. Default is all zero.

5.  sigma: The covariance matrix of independent variables, under
    X\_dist=NA. Default is diagonal.

6.  important: A numeric vector indicating which independent variables
    are important, i.e., in the linear regression model of generating
    dependent variable.

7.  intercept: A scalar specifying the intercept in the linear
    regression model of generating dependent variable. Default is 0.

8.  variance: A scalar specifying the variance of error in the linear
    regression model of generating dependent variable. Default is 1.

### Example

1.  Create 10 complete datasets, with sample size equals to 100. There
    are five independent variables in each dataset and all follow the
    multivariate normal distribution with zero means and diagonal
    covariance matrix. Dependent variable is generated by the linear
    model: X1+X2+error, where error follow a normal distribution with
    zero mean and variance equaling to one.

<!-- -->

    all_normal_data <- create_df(n_count = 10, n_sample = 100, n_x = 5, X_dist = NA, important = c(1,2))

    # the linear regression model of generating the dependent variable
    all_normal_data$model

    ## [1] "Y=0+X[,1]+X[,2]+error"

    # the independent variables' values of 3 cases in 10th dataset
    head(all_normal_data$Xs[[10]],3)

    ##              X1        X2        X3        X4         X5
    ## [1,]  0.5864344 2.0355870 0.7859357 0.4376863 0.09113027
    ## [2,] -0.8056358 0.7660771 0.6050743 1.2783245 0.52209146
    ## [3,] -0.8937527 2.6048537 0.4129891 1.5269640 1.24953266

    # the values of 3 cases in 10th dataset
    head(all_normal_data$dfs[[10]],3)

    ##           X1        X2        X3        X4         X5         Y
    ## 1  0.5864344 2.0355870 0.7859357 0.4376863 0.09113027 2.0920772
    ## 2 -0.8056358 0.7660771 0.6050743 1.2783245 0.52209146 1.1107034
    ## 3 -0.8937527 2.6048537 0.4129891 1.5269640 1.24953266 0.3449274

1.  Create 10 complete datasets, with sample size equals to 100. There
    are five independent variables in each dataset. Dependent variable
    is generated by the linear model: X1+X2+error, where error follow a
    normal distribution with zero mean and variance equaling to one.

<!-- -->

    # the distributions of the independent variables
    my_var <- c("rnorm(n=n_sample, 10,10)", "rnorm(n=n_sample, 0,100)",
              "rnorm(n=n_sample, 10,10)", "rnorm(n=n_sample, 0,100)",
              "rexp(n=n_sample, 1)")
    my_var_data <- create_df(n_count = 10, n_sample = 100, n_x = 5, X_dist = my_var, important = c(1,2))

    # the linear regression model of generating the dependent variable
    my_var_data$model

    ## [1] "Y=0+X[,1]+X[,2]+error"

    # the independent variables' values of 3 cases in 10th dataset
    head(my_var_data$Xs[[10]],3)

    ##                             X1        X2       X3         X4         X5
    ## X9.36164727315579    9.3616473 -139.3062 26.98931 -122.91437 0.07702083
    ## X.0.587231333333687 -0.5872313 -231.4489 36.09136   14.22101 0.32872152
    ## X10.1315177298028   10.1315177  160.0527 18.23103   14.48900 0.68787400

    # the values of 3 cases in 10th dataset
    head(my_var_data$dfs[[10]],3)

    ##                             X1        X2       X3         X4         X5
    ## X9.36164727315579    9.3616473 -139.3062 26.98931 -122.91437 0.07702083
    ## X.0.587231333333687 -0.5872313 -231.4489 36.09136   14.22101 0.32872152
    ## X10.1315177298028   10.1315177  160.0527 18.23103   14.48900 0.68787400
    ##                             Y
    ## X9.36164727315579   -129.1782
    ## X.0.587231333333687 -232.5143
    ## X10.1315177298028    168.8416

## Ampute the aforementioned datasets

`ampute_df`, using MICE::ampute(), can be used to ampute the complete
datasets, i.e. making some covariates missing.

    source("ampute_df.R", local = knitr::knit_global(), echo = FALSE)

    ## 
    ## 載入套件：'mice'

    ## 下列物件被遮斷自 'package:stats':
    ## 
    ##     filter

    ## 下列物件被遮斷自 'package:base':
    ## 
    ##     cbind, rbind

Arguments: 1. n\_count: A scalar specifying the number of complete
datasets.

1.  Xs: The list of the covariates’ dataframes.

2.  dfs: The list of the complete datasets.

3.  prop: A scalar specifying the proportion of missingness. Should be a
    value between 0 and 1. Default is a missingness proportion of 0.5.

4.  patterns: A matrix or data frame of size \#patterns by \#variables
    where 0 indicates that a variable should have missing values and 1
    indicates that a variable should remain complete. The user may
    specify as many patterns as desired. One pattern (a vector) is
    possible as well. Default is a square matrix of size \#variables
    where each pattern has missingness on one variable only (created
    with ampute.default.patterns). After the amputation procedure,
    md.pattern can be used to investigate the missing data patterns in
    the data.

5.  freq: A vector of length \#patterns containing the relative
    frequency with which the patterns should occur. For example, for
    three missing data patterns, the vector could be c(0.4, 0.4, 0.2),
    meaning that of all cases with missing values, 40 percent should
    have pattern 1, 40 percent pattern 2 and 20 percent pattern 3. The
    vector should sum to 1. Default is an equal probability for each
    pattern, created with ampute.default.freq.

6.  bycases: Logical. If TRUE, the proportion of missingness is defined
    in terms of cases. If FALSE, the proportion of missingness is
    defined in terms of cells. Default is TRUE.

### Example

1.  Ampute all\_normal\_data

<!-- -->

    amp_all_normal <- ampute_df(n_count = 10, Xs = all_normal_data$Xs, dfs = all_normal_data$dfs, prop=0.5, patterns=NULL, freq=NULL, bycases=TRUE)

    # the values of 3 cases in 10th amputed dataset
    head(amp_all_normal$ampdf[[10]], 3)

    ##           X1        X2        X3        X4        X5         Y
    ## 1  0.5864344 2.0355870 0.7859357 0.4376863        NA 2.0920772
    ## 2 -0.8056358 0.7660771        NA 1.2783245 0.5220915 1.1107034
    ## 3 -0.8937527 2.6048537 0.4129891 1.5269640 1.2495327 0.3449274

    # the missing pattern of 10th amputed dataset
    amp_all_normal$missing_pattern[[10]]

    ##    Y X4 X5 X1 X2 X3   
    ## 51 1  1  1  1  1  1  0
    ## 13 1  1  1  1  1  0  1
    ## 11 1  1  1  1  0  1  1
    ## 9  1  1  1  0  1  1  1
    ## 8  1  1  0  1  1  1  1
    ## 8  1  0  1  1  1  1  1
    ##    0  8  8  9 11 13 49

1.  Ampute my\_var\_data

<!-- -->

    amp_my_var <- ampute_df(n_count = 10, Xs = my_var_data$Xs, dfs = my_var_data$dfs, prop=0.5, patterns=NULL, freq=NULL, bycases=TRUE)

    # the values of 3 cases in 10th amputed dataset
    head(amp_my_var$ampdf[[10]], 3)

    ##                             X1        X2       X3         X4         X5
    ## X9.36164727315579    9.3616473 -139.3062 26.98931 -122.91437 0.07702083
    ## X.0.587231333333687 -0.5872313 -231.4489 36.09136   14.22101 0.32872152
    ## X10.1315177298028   10.1315177  160.0527 18.23103         NA 0.68787400
    ##                             Y
    ## X9.36164727315579   -129.1782
    ## X.0.587231333333687 -232.5143
    ## X10.1315177298028    168.8416

    # the missing pattern of 10th amputed dataset
    amp_my_var$missing_pattern[[10]]

    ##    Y X2 X1 X3 X5 X4   
    ## 53 1  1  1  1  1  1  0
    ## 12 1  1  1  1  1  0  1
    ## 10 1  1  1  1  0  1  1
    ## 10 1  1  1  0  1  1  1
    ## 8  1  1  0  1  1  1  1
    ## 7  1  0  1  1  1  1  1
    ##    0  7  8 10 10 12 47

## Impute with MICE

`impute_mice` specifies using MICE to impute and analyze the missing
datasets.

    source("impute_mice.R", local = knitr::knit_global(), echo = FALSE)

Arguments: 1. n\_count: A scalar specifying the number of complete
datasets.

1.  n\_x: A scalar specifying the number of independent variables in
    each dataset.

2.  ampdf: The list of amputed datasets

3.  predictor\_matrix: A numeric matrix of length(blocks) rows and
    ncol(data) columns, containing 0/1 data specifying the set of
    predictors to be used for each target column. Each row corresponds
    to a variable block, i.e., a set of variables to be imputed. A value
    of 1 means that the column variable is used as a predictor for the
    target block (in the rows). By default, the predictorMatrix is a
    square matrix of ncol(data) rows and columns with all 1’s, except
    for the diagonal. Note: For two-level imputation models (which have
    “2l” in their names) other codes (e.g, 2 or -2) are also allowed.

4.  m: Number of multiple imputations. The default is m=5.

5.  meth: Can be either a single string, or a vector of strings with
    length length(blocks), specifying the imputation method to be used
    for each column in data. If specified as a single string, the same
    method will be used for all blocks. The default imputation method
    (when no argument is specified) depends on the measurement level of
    the target column, as regulated by the defaultMethod argument.
    Columns that need not be imputed have the empty method "". See
    details.

6.  lm\_expr: A string specifies the expression showing which variables
    should be place in the analysis model.

7.  alpha: A numeric value specifies the significance level of the
    analysis model. The Default is 0.05.

### Example

1.  Impute all\_normal using impute\_mice()

<!-- -->

    all_normal_mice <- impute_mice(n_count = 10, n_x = 5, ampdf = amp_all_normal$ampdf, lm_expr = all_normal_data$lm)

    # output the mean of the pooled estimate, lambda, within-variance, between-variance and the total variance of the pooled estimate. 
    all_normal_mice$mean_output

    ## $mean_estimate
    ##   intercept          X1          X2          X3          X4          X5 
    ##  0.02597313  0.95805706  0.97308673 -0.03071195 -0.03570780  0.06103320 
    ## 
    ## $mean_ubar
    ##  intercept         X1         X2         X3         X4         X5 
    ## 0.01102136 0.01138890 0.01162323 0.01215025 0.01022497 0.01167475 
    ## 
    ## $mean_b
    ##   intercept          X1          X2          X3          X4          X5 
    ## 0.001532612 0.001522148 0.001491230 0.003048814 0.001328116 0.003678171 
    ## 
    ## $mean_t
    ##  intercept         X1         X2         X3         X4         X5 
    ## 0.01286050 0.01321548 0.01341271 0.01580882 0.01181871 0.01608856 
    ## 
    ## $mean_lambda
    ## intercept        X1        X2        X3        X4        X5 
    ## 0.1342415 0.1323057 0.1255606 0.2192791 0.1315279 0.2485480

    # for each variable, output the frequency of the p-value larger than alpha.
    all_normal_mice$p.value_freq

    ## intercept        X1        X2        X3        X4        X5 
    ##         2        10        10         0         1         0

    # runtime
    all_normal_mice$runtime

    ## Time difference of 4.00032 secs

1.  Impute my\_var using impute\_mice()

<!-- -->

    my_var_mice <- impute_mice(n_count = 10, n_x = 5, ampdf = amp_my_var$ampdf, lm_expr = my_var_data$lm)

    ## Warning: Number of logged events: 25

    ## Warning: Number of logged events: 25

    ## Warning: Number of logged events: 25

    ## Warning: Number of logged events: 25

    ## Warning: Number of logged events: 25

    ## Warning: Number of logged events: 25

    ## Warning: Number of logged events: 25

    ## Warning: Number of logged events: 25

    ## Warning: Number of logged events: 25

    ## Warning: Number of logged events: 25

    # output the mean of the pooled estimate, lambda, within-variance, between-variance and the total variance of the pooled estimate. 
    my_var_mice$mean_output

    ## $mean_estimate
    ##    intercept           X1           X2           X3           X4           X5 
    ## -2.793843683  0.893217979  0.919217808  0.093467349 -0.005333617  0.600514705 
    ## 
    ## $mean_ubar
    ##    intercept           X1           X2           X3           X4           X5 
    ## 74.679811614  0.175181213  0.001829826  0.181796537  0.001767548 20.537557412 
    ## 
    ## $mean_b
    ##    intercept           X1           X2           X3           X4           X5 
    ## 3.708494e+01 1.029241e-01 1.435776e-03 1.169454e-01 9.910889e-04 9.016953e+00 
    ## 
    ## $mean_t
    ##    intercept           X1           X2           X3           X4           X5 
    ## 1.191817e+02 2.986901e-01 3.552758e-03 3.221310e-01 2.956854e-03 3.135790e+01 
    ## 
    ## $mean_lambda
    ## intercept        X1        X2        X3        X4        X5 
    ## 0.3472022 0.3533038 0.4712952 0.4108659 0.3765205 0.3198319

    # for each variable, output the frequency of which the p-value is larger than alpha.
    my_var_mice$p.value_freq

    ## intercept        X1        X2        X3        X4        X5 
    ##         0         3        10         0         0         0

    # runtime
    my_var_mice$runtime

    ## Time difference of 4.059143 secs

## Impute with kNN

`impute_kNN` specifies using VIM::kNN to impute and analyze the missing
datasets.

    source("impute_kNN.R", local = knitr::knit_global(), echo = FALSE)

    ## Warning: 套件 'VIM' 是用 R 版本 4.1.1 來建造的

    ## 載入需要的套件：colorspace

    ## Warning: 套件 'colorspace' 是用 R 版本 4.1.1 來建造的

    ## 載入需要的套件：grid

    ## VIM is ready to use.

    ## Suggestions and bug-reports can be submitted at: https://github.com/statistikat/VIM/issues

    ## 
    ## 載入套件：'VIM'

    ## 下列物件被遮斷自 'package:datasets':
    ## 
    ##     sleep

Arguments: 1. n\_count: A scalar specifying the number of complete
datasets.

1.  n\_x: A scalar specifying the number of independent variables in
    each dataset.

2.  ampdf: The list of amputed datasets.

3.  k: A scalar or numeric vector of Nearest Neighbours used.

4.  dist\_var: Variables to be used for distance calculation. Default is
    all the variables.

5.  weights: Weights for the variables for distance calculation. If
    weights = “auto” weights will be selected based on variable
    importance from random forest regression, using function
    ranger::ranger(). Weights are calculated for each variable
    seperately. Default is NULL.

6.  numFun: Function for aggregating the k Nearest Neighbours in the
    case of a numerical variable. Default is the median.

7.  catFun: Function for aggregating the k Nearest Neighbours in the
    case of a categorical variable. Default is the function maxCat.

8.  weightDist: TRUE/FALSE if the distances of the k nearest neighbours
    should be used as weights in the aggregation step. Default is FALSE.

9.  alpha: A numeric value specifies the significance level of the
    analysis model. The Default is 0.05.

10. lm\_expr: A string specifies the expression showing which variables
    should be place in the analysis model.

### Example

1.  Impute all\_normal using impute\_kNN()

<!-- -->

    all_normal_kNN <- impute_kNN(n_count = 10, n_x = 5, ampdf = amp_all_normal$ampdf, k = c(1,3,5,7,9), lm_expr = all_normal_data$lm)

    # output the mean of the pooled estimate, lambda, within-variance, between-variance and the total variance of the pooled estimate. 
    all_normal_kNN$mean_output

    ## $mean_estimate
    ##   intercept          X1          X2          X3          X4          X5 
    ##  0.04018909  0.94935454  0.99844222 -0.03134637 -0.03149449  0.07300812 
    ## 
    ## $mean_ubar
    ##  intercept         X1         X2         X3         X4         X5 
    ## 0.01162054 0.01296584 0.01290220 0.01368031 0.01141354 0.01298846 
    ## 
    ## $mean_b
    ##    intercept           X1           X2           X3           X4           X5 
    ## 0.0003141985 0.0003965133 0.0007370800 0.0006576570 0.0004770515 0.0007331829 
    ## 
    ## $mean_t
    ##  intercept         X1         X2         X3         X4         X5 
    ## 0.01199758 0.01344166 0.01378670 0.01446949 0.01198600 0.01386828 
    ## 
    ## $mean_lambda
    ##  intercept         X1         X2         X3         X4         X5 
    ## 0.03157084 0.03671370 0.05781674 0.04826713 0.04827376 0.06254214

    # for each variable, output the frequency of the p-value larger than alpha.
    all_normal_kNN$p.value_freq

    ## intercept        X1        X2        X3        X4        X5 
    ##         2        10        10         0         0         1

    # runtime
    all_normal_kNN$runtime

    ## Time difference of 2.987904 secs

1.  Impute my\_var using impute\_kNN()

<!-- -->

    my_var_kNN <- impute_kNN(n_count = 10, n_x = 5, ampdf = amp_my_var$ampdf, k = c(1,3,5,7,9), lm_expr = my_var_data$lm)

    # output the mean of the pooled estimate, lambda, within-variance, between-variance and the total variance of the pooled estimate. 
    my_var_kNN$mean_output

    ## $mean_estimate
    ##    intercept           X1           X2           X3           X4           X5 
    ## -1.195718189  0.963493181  1.009487627  0.033882718 -0.002198201  1.026449652 
    ## 
    ## $mean_ubar
    ##    intercept           X1           X2           X3           X4           X5 
    ## 1.375556e+01 3.251322e-02 3.334961e-04 3.292240e-02 3.201893e-04 3.433430e+00 
    ## 
    ## $mean_b
    ##    intercept           X1           X2           X3           X4           X5 
    ## 3.9431340069 0.0132639744 0.0001255923 0.0124960096 0.0000770228 1.2653145956 
    ## 
    ## $mean_t
    ##    intercept           X1           X2           X3           X4           X5 
    ## 1.848732e+01 4.842999e-02 4.842068e-04 4.791761e-02 4.126167e-04 4.951808e+00 
    ## 
    ## $mean_lambda
    ## intercept        X1        X2        X3        X4        X5 
    ## 0.2140545 0.2732894 0.2584817 0.2979722 0.2256215 0.2756661

    # for each variable, output the frequency of which the p-value is larger than alpha.
    my_var_kNN$p.value_freq

    ## intercept        X1        X2        X3        X4        X5 
    ##         0         9        10         0         0         1

    # runtime
    my_var_kNN$runtime

    ## Time difference of 2.86293 secs

## Impute with hot.deck()

`impute_hd` specifies using hot.deck::hot.deck to impute and analyze the
missing datasets.

    source("impute_hd.R", local = knitr::knit_global(), echo = FALSE)

    ## Warning: 套件 'hot.deck' 是用 R 版本 4.1.1 來建造的

Arguments: 1. n\_count: A scalar specifying the number of complete
datasets.

1.  n\_x: A scalar specifying the number of independent variables in
    each dataset.

2.  ampdf: The list of amputed datasets

3.  m: Number of multiple imputations. The default is m=5.

4.  method: Method used to draw donors based on affinity either
    “best.cell” (the default) or “p.draw” for probabilistic draw.

5.  sdCutoff: Number of standard deviations between observations such
    that observations fewer than sdCutoff standard deviations away from
    each other are considered sufficiently close to be a match,
    otherwise they are considered too far away to be a match. Default
    is 1.

6.  alpha: A numeric value specifies the significance level of the
    analysis model. The Default is 0.05.

7.  lm\_expr: A string specifies the expression showing which variables
    should be place in the analysis model.

### Example

1.  Impute all\_normal using impute\_hd()

<!-- -->

    all_normal_hd <- impute_hd(n_count = 10, n_x = 5, ampdf = amp_all_normal$ampdf, sdCutoff = 5, lm_expr = all_normal_data$lm)

    # output the mean of the pooled estimate, lambda, within-variance, between-variance and the total variance of the pooled estimate. 
    all_normal_hd$mean_output

    ## $mean_estimate
    ##   intercept          X1          X2          X3          X4          X5 
    ##  0.00848187  0.87566223  0.90510713 -0.05220269 -0.02062788  0.06901322 
    ## 
    ## $mean_ubar
    ##  intercept         X1         X2         X3         X4         X5 
    ## 0.01377421 0.01412574 0.01417850 0.01521337 0.01277001 0.01449739 
    ## 
    ## $mean_b
    ##   intercept          X1          X2          X3          X4          X5 
    ## 0.001356083 0.002703276 0.003094968 0.002603543 0.002237190 0.002458927 
    ## 
    ## $mean_t
    ##  intercept         X1         X2         X3         X4         X5 
    ## 0.01540151 0.01736968 0.01789246 0.01833762 0.01545464 0.01744810 
    ## 
    ## $mean_lambda
    ## intercept        X1        X2        X3        X4        X5 
    ## 0.1041335 0.1858502 0.1999053 0.1510257 0.1640667 0.1601904

    # for each variable, output the frequency of the p-value larger than alpha.
    all_normal_hd$p.value_freq

    ## intercept        X1        X2        X3        X4        X5 
    ##         1        10        10         0         0         1

    # runtime
    all_normal_hd$runtime

    ## Time difference of 0.8404779 secs

1.  Impute my\_var using impute\_hd()

<!-- -->

    my_var_hd <- impute_hd(n_count = 10, n_x = 5, ampdf = amp_my_var$ampdf, method = "p.draw", lm_expr = my_var_data$lm)

    # output the mean of the pooled estimate, lambda, within-variance, between-variance and the total variance of the pooled estimate. 
    my_var_hd$mean_output

    ## $mean_estimate
    ##    intercept           X1           X2           X3           X4           X5 
    ## -2.330561755  0.936841142  0.934127984  0.083033281 -0.007450805  0.395679571 
    ## 
    ## $mean_ubar
    ##    intercept           X1           X2           X3           X4           X5 
    ## 60.932531076  0.140854431  0.001500141  0.149112329  0.001411550 16.603599887 
    ## 
    ## $mean_b
    ##    intercept           X1           X2           X3           X4           X5 
    ## 2.530436e+01 8.738958e-02 2.024875e-03 9.660315e-02 7.006837e-04 1.392398e+01 
    ## 
    ## $mean_t
    ##    intercept           X1           X2           X3           X4           X5 
    ## 91.297762548  0.245721926  0.003929991  0.265036107  0.002252370 33.312378462 
    ## 
    ## $mean_lambda
    ## intercept        X1        X2        X3        X4        X5 
    ## 0.3474572 0.4234448 0.5738849 0.3820116 0.3137731 0.4263477

    # for each variable, output the frequency of which the p-value is larger than alpha.
    my_var_hd$p.value_freq

    ## intercept        X1        X2        X3        X4        X5 
    ##         0         3        10         0         0         0

    #runtime
    my_var_hd$runtime

    ## Time difference of 1.722871 secs
